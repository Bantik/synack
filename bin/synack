#!/usr/bin/env ruby -wKU

require 'getopt/long'
require 'synack'

options = Getopt::Long.getopts(
  ["--message", "-m", Getopt::REQUIRED],
  ["--server", "-s", Getopt::OPTIONAL],
  ["--host", "-h", Getopt::OPTIONAL],
  ["--port", "-p", Getopt::OPTIONAL]
)

@host = options['host'] || 'localhost'
@port = options['port'] || 11113

if options["server"]
  Synack::Server.start(
    host: @host,
    port: @port
  )
else
  begin
    client = Synack::Client.new(
      host: @host,
      port: @port
    )

    _input = options['message']
    client.say _input
  rescue DRb::DRbConnError => e
    puts "Some kind of connection error occurred: #{e}"
  end
end
